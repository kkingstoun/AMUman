{% extends "manager/base.html" %}

{% block title %}Tasks list{% endblock %}
{% block name %}Tasks list{% endblock %}
{% block content %}
<div class="container table-responsive">

    {% if messages %}
        <div class="messages responsive">
            {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}{% endif %} alert-dismissible fade show" role="alert">
                    {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}<i class="fas fa-check-circle"></i> {% endif %}
                    {% if message.level == DEFAULT_MESSAGE_LEVELS.INFO %}<i class="fas fa-info-circle"></i> {% endif %}
                    {% if message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}<i class="fas fa-exclamation-triangle"></i> {% endif %}
                    {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}<i class="fas fa-exclamation-circle"></i> {% endif %}
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <table class="table table-striped table-dark table-bordered table-fit table-hover table-sm">
        <thead class="thead-dark align-middle">
            <tr>
                <th>no.</th>
                <th>ID</th>
                <th>User</th>
                <th>Path</th>
                <th>Node Name</th>
                <th>Port</th>
                <th>Submit Time</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Error Time</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Est. Sim. time</th>
                <th>Assigned node</th>
                <th>Assigned gpu</th>
                <th>Output</th>
                <th>Remove permanenty task</th>
                <th>Edit</th>
                <th>Run</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ task.id }}</td>
                <td>{{ task.user }}</td>
                <td style="width:250px">{{ task.path }}</td>
                <td>{{ task.node_name }}</td>
                <td>{{ task.port }}</td>
                <td>{{ task.submit_time }}</td>
                <td>{{ task.start_time }}</td>
                <td>{{ task.end_time }}</td>
                <td>{{ task.error_time }}</td>
                <td>{{ task.priority }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.est }}</td>
                <td>{{task.assigned_node_id}}</td>
                <td>{{task.assigned_gpu_id}}</td>
                <td>
                    <a href="{% url 'task_action_id' 'output' task.id %}" class="btn btn-info btn-sm">Output</a>
                </td>
                <td>
                    <a href="{% url 'task_action_id' 'delete' task.id %}" class="btn btn-danger btn-sm">Remove</a>
                </td>
                <td>
                    <a href="{% url 'task_action_id' 'edit' task.id %}" class="btn btn-info btn-sm">Edit</a>
                </td>
                <td>
                    <a href="{% url 'task_action_id' 'run' task.id %}" class="btn btn-success btn-sm">Run</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div class="row">
    <div class="col-lg-12">
        <p class="page-title lead">
            Active tasks
        </p>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="container table-responsive">
            <table class="table table-striped table-dark table-bordered table-fit table-hover table-sm">
                <thead class="thead-dark">
                    <tr>
                        <th>no.</th>
                        <th>ID</th>
                        <th>Path</th>
                        <th>Node Name</th>
                        <th>Port</th>
                        <th>Submit Time</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Error Time</th>
                        <th>Priority</th>
                        <th>Status</th>
                        <th>Est. Sim. time</th>
                        <th>Assigned node</th>
                        <th>Assigned gpu</th>
                        <th>Outputs</th>
                        <th>Remove permanenty task</th>
                        <th>Move back to queue</th>
                        <th>Redo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in active_tasks %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ task.id }}</td>
                        <td style="width:250px">{{ task.path }}</td>
                        <td>{{ task.node_name }}</td>
                        <td>{{ task.port }}</td>
                        <td>{{ task.submit_time }}</td>
                        <td>{{ task.start_time }}</td>
                        <td>{{ task.end_time }}</td>
                        <td>{{ task.error_time }}</td>
                        <td>{{ task.priority }}</td>
                        <td>{{ task.status }}</td>
                        <td>{{ task.est }}</td>
                        <td>{{task.assigned_node_id}}
                        <td>{{task.assigned_gpu_id}}
                        <td>
                            <a href="{% url 'task_action_id' 'output' task.id %}" class="btn btn-info btn-sm">Output</a>
                        </td>
                        <td>
                            <a href="{% url 'task_action_id' 'delete' task.id %}" class="btn btn-danger btn-sm">Remove</a>
                        </td>
                        <td>
                            <a href="{% url 'task_action_id' 'cancel' task.id %}" class="btn btn-danger btn-sm">Cancel</a>
                        </td>
                        <td>
                            <a href="{% url 'task_action_id' 'redo' task.id %}" class="btn btn-success btn-sm">Redo</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

<script>
    window.addEventListener('load', (event) => {
        {% if messages %}
            {% for message in messages %}
                alert("{{ message }}");
            {% endfor %}
        {% endif %}
    });
</script>
